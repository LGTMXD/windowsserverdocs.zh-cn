---
title: 步骤2配置 APP1
description: 本主题是测试实验室指南的一部分-演示带有 OTP 身份验证的 DirectAccess 和用于 Windows Server 2016 的 RSA SecurID
manager: brianlic
ms.prod: windows-server
ms.technology: networking-da
ms.topic: article
ms.assetid: 19a7a4a6-9a04-42ea-a5d0-ecb28a34dbaa
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 03cddb638277f04a79cf4f41d6d2df308a1cf50e
ms.sourcegitcommit: d5e27c1f2f168a71ae272bebf8f50e1b3ccbcca3
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/23/2020
ms.locfileid: "86966139"
---
# <a name="step-2-configure-app1"></a>步骤2配置 APP1

>适用于：Windows Server（半年频道）、Windows Server 2016

使用以下步骤为 OTP 支持准备 APP1：  
  
1. 创建和部署用于对 OTP 证书请求进行签名的证书模板。 配置用于对 OTP 证书请求进行签名的证书模板。  
  
2. 为公司 CA 颁发的 OTP 证书创建和部署证书模板。 为公司 CA 颁发的 OTP 证书配置证书模板。  
  
> [!WARNING]  
> 本测试实验室指南的设计包括基础结构服务器，如运行 Windows Server 2012 R2 或 Windows Server 2012 的域控制器和证书颁发机构（CA）。 本指南中未介绍如何使用此测试实验室指南来配置运行其他操作系统的基础结构服务器，以及配置其他操作系统的说明。  
  
## <a name="to-create-and-deploy-a-certificate-template-used-to-sign-otp-certificate-requests"></a><a name="DAOTPRA"></a>创建和部署用于对 OTP 证书请求进行签名的证书模板  
  
1.  运行**certtmpl**，然后按 enter。  
  
2.  在 "证书模板" 控制台的 "详细信息" 窗格中，右键单击 "**计算机**" 模板，然后单击 "**复制模板**"。  
  
3.  在 "**新模板的属性**" 对话框的 "**兼容性**" 选项卡上的 "**证书颁发机构**" 列表中，选择所需的操作系统，然后在 "**结果更改**" 对话框中单击 **"确定"**。 在 "**证书收件人**列表" 中，选择所需的操作系统，然后在 "**生成的更改**" 对话框中单击 **"确定"**。  
  
4.  在 "**新模板的属性**" 对话框中，单击 "**常规**" 选项卡。  
  
5.  在 "**常规**" 选项卡上的 "**模板显示名称**" 中，键入**DAOTPRA**。 将 "**有效期**" 设置为 "2"，将 "**续订期**" 设置为 "1 天"。 如果显示 "**证书模板**" 警告，请单击 **"确定"**。  
  
6.  单击“安全性”**** 选项卡，然后单击“添加”****。  
  
7.  在 "**选择用户、计算机、服务帐户或组**" 对话框中，单击 "**对象类型**"。 在 "**对象类型**" 对话框中，选择 "**计算机**"，然后单击 **"确定"**。 在 "**输入要选择的对象名称**" 框中，键入**EDGE1**，单击 **"确定**"，然后在 "**允许**" 列中选中 "**读取**"、"**注册**" 和 "**自动注册**" 复选框。 单击 "**经过身份验证的用户**"，选中 "**允许**" 列下的 "**读取**" 复选框，并清除所有其他复选框。 单击 "**域计算机**"，并取消选中 "**允许**" 列下的 "**注册**"。 单击 "**域管理员**和**企业管理员**"，然后单击 "**允许**" 列下的 "**完全控制**"。 单击“应用”。  
  
8.  单击 "**使用者名称**" 选项卡，然后单击 "从此**Active Directory 信息生成**"。 在 "**使用者名称格式：** 列表选择**dns 名称**" 中，确保已选中 " **dns 名称**" 框，然后单击 "**应用**"。  
  
9. 单击 "**扩展**" 选项卡，选择 "**应用程序策略**"，然后单击 "**编辑**"。 删除所有现有的应用程序策略。 单击 "**添加**"，在 "**添加应用程序策略**" 对话框中，单击 "**新建**"，在 "**名称：** " 字段中输入**DA OTP RA** ，在 "**对象标识符：** " 字段中输入**1.3.6.1.4.1.311.81.1.1** ，然后单击 **"确定"**。 在 "**添加应用程序策略**" 对话框中，单击 **"确定"**。 在 "**编辑应用程序策略" 扩展**上，单击 **"确定"**。 在 "**新模板的属性**" 对话框中，单击 **"确定"**。  
  
## <a name="to-create-and-deploy-a-certificate-template-for-otp-certificates-issued-by-the-corporate-ca"></a><a name="DAOTPLogon"></a>为公司 CA 颁发的 OTP 证书创建和部署证书模板  
  
1.  在 "证书模板" 控制台的 "详细信息" 窗格中，右键单击 "**智能卡登录**" 模板，然后单击 "**复制模板**"。  
  
2.  在 "**新模板的属性**" 对话框中，在 **"兼容性**" 选项卡上的 "**证书颁发机构**" 列表中，单击要使用的操作系统，然后在 "**生成的更改**" 对话框中单击 **"确定"**。 在 "**证书收件人**列表" 中，选择要使用的操作系统，然后在 "**生成的更改**" 对话框中单击 **"确定"**。  
  
3.  在 "**新模板的属性**" 对话框中，单击 "**常规**" 选项卡。  
  
4.  在 "**常规**" 选项卡上的 "**模板显示名称**" 中，键入**DAOTPLogon**。 在 "**有效期**" 的下拉列表中，单击 "**小时**"，在 "**证书模板**" 对话框中，单击 **"确定**"，并确保将小时数设置为1。 在**续订期内**，键入**0**。  
  
    > [!IMPORTANT]  
    > **Windows Server 2003 CA**。 如果证书颁发机构（CA）在运行 Windows Server 2003 的计算机上，则必须在另一台计算机上配置证书模板。 这是必需的，因为在运行 Windows Server 2008 和 Windows Vista 之前的 Windows 版本时，不能以小时为单位设置**有效期**。 如果用于配置模板的计算机未安装 Active Directory 证书服务服务器角色，或者它是一台客户端计算机，则可能需要安装 "证书模板" 管理单元。 有关详细信息，请参阅[安装证书模板管理单元](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732445(v=ws.11))。  
    >   
    > **Windows Server 2008 R2 CA**。 如果你已经部署了运行 Windows Server 2008 R2 的证书颁发机构（CA），则必须将证书模板**续订期**配置为1或2小时，**有效期**应比**续订期**长，但不超过4小时。 如果使用运行 Windows Server 2008 R2 的 CA 配置的证书模板**有效期**不超过4小时，则 directaccess 安装向导将无法检测证书模板，directaccess 安装会失败。  
  
5.  单击 "**安全**" 选项卡，在 "**允许**" 列中选择 "**已验证用户**"，然后选中 "**读取**" 和 "**注册**" 复选框。 单击“确定”  。 单击 "**域管理员**" 和 "**企业管理员**"，然后单击 "**允许**" 列下的 "**完全控制**"。 单击“应用”。  
  
6.  单击 "**使用者名称**" 选项卡，然后单击 "从此**Active Directory 信息生成**"。 在 "**使用者名称格式：** " 列表中，选择 "**完全可分辨名称**"，确保选中 "**用户主体名称（UPN）** " 框，然后单击 "**应用**"。  
  
7.  单击 "**服务器**" 选项卡，选中 "**不将证书和请求存储在 CA 数据库中**" 复选框，清除 "**不在已颁发的证书中包含吊销信息**" 复选框，然后在 "**新模板的属性**" 对话框中，单击 "**应用**"。  
  
8.  单击 "**颁发要求**" 选项卡，选中 "**此数量的授权签名：** " 复选框，将值设置为1。 在 "**签名：列表所需的策略类型**" 列表中，选择 "**应用程序策略**"，然后在**应用程序策略**列表中选择 " **DA OTP RA**"。 在 "**新模板的属性**" 对话框中，单击 **"确定"**。  
  
9. 单击 "**扩展**" 选项卡，然后在 "**应用程序策略**" 中单击 "**编辑**"。 删除**客户端身份验证**，保留**SmartCardLogon**，并单击 **"确定"** 两次。  
  
10. 关闭“证书模板控制台”。  
  
11. 在 "**开始**" 屏幕上，键入 "**certsrv**"，然后按 enter。  
  
12. 在 "证书颁发机构" 控制台树中，展开 " **APP1-1**"，单击 "**证书模板**"，右键单击 "**证书模板**"，指向 "**新建**"，然后单击 "**要颁发的证书模板**"。  
  
13. 在证书模板列表中，单击 " **DAOTPRA** " 和 " **DAOTPLogon**"，然后单击 **"确定"**。  
  
14. 在控制台的详细信息窗格中，应会看到**DAOTPRA**证书模板，其**目标**是使用**DA OTP RA** ，将**DAOTPLogon**证书**模板用于****智能卡登录**。  
  
15. 重启服务。  
  
16. 关闭证书颁发机构控制台。  
  
17. 打开权限提升的命令提示符。 键入**CertUtil.exe-SetReg DBFlags + DBFLAGS_ENABLEVOLATILEREQUESTS**，然后按 enter。  
  
18. 使命令提示符窗口保持打开状态以进行下一步。  
  
