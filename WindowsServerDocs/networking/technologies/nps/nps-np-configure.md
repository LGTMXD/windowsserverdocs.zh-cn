---
title: 配置网络策略
description: 本主题概述了 Windows Server 2016 中网络策略服务器的网络策略配置。
manager: brianlic
ms.topic: article
ms.assetid: fe77655a-e2be-4949-92e1-aaaa215d86ea
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 88c35f983ae998312ad3353245927c943869d7f0
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/07/2020
ms.locfileid: "87952052"
---
# <a name="configure-network-policies"></a>配置网络策略

>适用于：Windows Server（半年频道）、Windows Server 2016

你可以使用本主题在 NPS 中配置网络策略。

## <a name="add-a-network-policy"></a>添加网络策略

网络策略服务器 \( NPS \) 使用网络策略和用户帐户的拨入属性来确定连接请求是否有权连接到网络。

可以使用此过程在 NPS 控制台或远程访问控制台中配置新的网络策略。

### <a name="performing-authorization"></a>执行授权

当 NPS 执行连接请求授权时，会将请求与策略的有序列表中的每个网络策略进行比较，从第一个策略开始，然后沿配置的策略列表向下移动。 如果 NPS 找到了条件与连接请求匹配的策略，则 NPS 将使用匹配的策略和用户帐户的拨入属性来执行授权。 如果将用户帐户的拨入属性配置为通过网络策略授予访问权或控制访问权并对连接请求进行授权，则 NPS 会将在网络策略中配置的设置应用于连接。

如果 NPS 找不到与连接请求匹配的网络策略，则将拒绝连接请求，除非将用户帐户上的拨入属性设置为授予访问权。

如果将用户帐户的拨入属性设置为拒绝访问，则 NPS 将拒绝连接请求。

### <a name="key-settings"></a>关键设置

当你使用新建网络策略向导来创建网络策略时，你在 "**网络连接" 方法**中指定的值将用于自动配置**策略类型**条件：

- 如果保留默认值 "未指定"，则 NPS 将使用任何类型的网络访问服务器 (NAS) 为所有网络连接类型评估所创建的网络策略。
- 如果指定了网络连接方法，则只有在连接请求源自您所指定的网络访问服务器类型时，NPS 才会评估网络策略。

在 "**访问权限**" 页上，如果希望策略允许用户连接到网络，则必须选择 "**授予访问权限**"。 如果希望策略阻止用户连接到网络，请选择 "**拒绝访问**"。

如果希望 Active Directory 域服务中的用户帐户拨入属性来确定访问权限 &reg; \( AD DS \) ，你可以选择 "**访问由用户拨入属性决定**" 复选框。

若要完成该过程，必须至少具有 **Domain Admins** 的成员资格或同等权限。

### <a name="to-add-a-network-policy"></a>添加网络策略

1. 打开 NPS 控制台，然后双击 "**策略**"。

2. 在控制台树中，右键单击 "**网络策略**"，然后单击 "**新建**"。 将打开新建网络策略向导。

3. 使用“新建网络策略”向导来创建策略。

## <a name="create-network-policies-for-dial-up-or-vpn-with-a-wizard"></a>使用向导为拨号或 VPN 创建网络策略

你可以使用此过程来创建连接请求策略和网络策略，以将拨号服务器或虚拟专用网络 \( VPN \) 服务器作为远程身份验证拨入用户服务 \( RADIUS \) 客户端部署到 NPS RADIUS 服务器。

>[!NOTE]
>客户端计算机（如便携式计算机和其他运行客户端操作系统的计算机）不是 RADIUS 客户端。 RADIUS 客户端是网络访问服务器（如无线访问点、802.1 X 身份验证交换机、虚拟专用网络 \( VPN \) 服务器和拨号服务器），因为这些设备使用 radius 协议来与 radius 服务器（如 NPSs）进行通信。

此过程说明如何在 NPS 中打开新建拨号或虚拟专用网络连接向导。

运行向导后，将创建下列策略：

- 一个连接请求策略
- 一个网络策略

可以在每次需要为拨号服务器和 VPN 服务器创建新策略时运行新建拨号或虚拟专用网络连接向导。

运行 "新建拨号或虚拟专用网络连接向导" 并不是将拨号或 VPN 服务器作为 RADIUS 客户端部署到 NPS 所需的唯一步骤。 两种网络访问方法都需要部署其他硬件和软件组件。

若要完成该过程，必须至少具有 **Domain Admins** 的成员资格或同等权限。

### <a name="to-create-policies-for-dial-up-or-vpn-with-a-wizard"></a>使用向导为拨号或 VPN 创建策略的步骤

1. 打开 NPS 控制台。 如果尚未选择，请单击 " **NPS \( 本地 \) **"。 如果要在远程 NPS 上创建策略，请选择该服务器。

2. 在 "**入门**和**标准配置**" 中，选择 "**用于拨号或 VPN 连接的 RADIUS 服务器**"。 此文本下的文本和链接将更改，以反映您的选择。

3. 单击 "**使用向导配置 VPN 或拨号**"。 这将会打开新建拨号或虚拟专用网络连接向导。

4. 按照向导中的说明完成创建新策略。

## <a name="create-network-policies-for-8021x-wired-or-wireless-with-a-wizard"></a>使用向导创建 802.1 X 有线或无线网络策略

你可以使用此过程来创建连接请求策略和网络策略，以将 802.1 X 身份验证交换机或 802.1 X 无线访问点作为远程身份验证拨入用户服务 (RADIUS) 客户端连接到 NPS RADIUS 服务器。

此过程说明如何在 NPS 中启动新的 IEEE 802.1 X 安全有线和无线连接向导。

运行向导后，将创建下列策略：

- 一个连接请求策略
- 一个网络策略

可以在每次需要新建 802.1X 访问策略时，运行新建 IEEE 802.1X 安全有线和无线连接向导。

运行 "新建 IEEE 802.1 X 安全有线和无线连接向导" 不是将 802.1 X 身份验证交换机和无线访问点作为 RADIUS 客户端部署到 NPS 的唯一步骤。 两种网络访问方法都需要部署其他硬件和软件组件。

若要完成该过程，必须至少具有 **Domain Admins** 的成员资格或同等权限。

### <a name="to-create-policies-for-8021x-wired-or-wireless-with-a-wizard"></a>使用向导为 802.1X 有线或无线创建策略的步骤

1. 在 NPS 上服务器管理器中，单击 "**工具**"，然后单击 "**网络策略服务器**"。 此时将打开 NPS 控制台。

2. 如果尚未选择，请单击 " **NPS \( 本地 \) **"。 如果要在远程 NPS 上创建策略，请选择该服务器。

3. 在**入门**"和"**标准配置**"中，选择" **RADIUS 服务器 "802.1 x 无线连接或" 有线连接**"。 此文本下的文本和链接将更改，以反映您的选择。

4. 单击 "**使用向导配置 802.1 x**"。 打开新建 IEEE 802.1X 安全有线和无线连接向导。

5. 按照向导中的说明完成创建新策略。

## <a name="configure-nps-to-ignore-user-account-dial-in-properties"></a>将 NPS 配置为忽略用户帐户的拨入属性

使用此过程配置 NPS 网络策略，以忽略在授权过程中 Active Directory 的用户帐户的拨入属性。 如果用户帐户的 "**网络访问权限**" 属性设置为 "**通过 NPS 网络策略控制访问**"，则 Active Directory 用户和计算机中的用户帐户具有在授权过程中 NPS 评估的拨入属性。

在以下两种情况下，你可能希望将 NPS 配置为忽略 Active Directory 中用户帐户的拨入属性：

- 当你要使用网络策略简化 NPS 授权时，但并非所有用户帐户都将 "**网络访问权限**" 属性设置为 "**通过 NPS 网络策略控制访问**"。 例如，某些用户帐户可能将用户帐户的 "**网络访问权限**" 属性设置为 "**拒绝访问**" 或 "**允许访问**"。

- 如果用户帐户的其他拨入属性不适用于网络策略中配置的连接类型。 例如，除 "**网络访问权限**" 设置之外的属性仅适用于拨入或 VPN 连接，但你正在创建的网络策略适用于无线或身份验证切换连接。

您可以使用此过程将 NPS 配置为忽略用户帐户的拨入属性。 如果连接请求与选中此复选框的网络策略相匹配，则 NPS 不使用用户帐户的拨入属性来确定该用户或计算机是否有权访问该网络;仅使用网络策略中的设置来确定授权。

**Administrators**中的成员身份或同等身份是完成此过程所需的最低要求。

1. 在 NPS 上服务器管理器中，单击 "**工具**"，然后单击 "**网络策略服务器**"。 此时将打开 NPS 控制台。

2. 双击 "**策略**"，单击 "**网络策略**"，然后在详细信息窗格中，双击要配置的策略。

3. 在 "策略**属性**" 对话框的 "**概述**" 选项卡上，在 "**访问权限**" 中选中 "**忽略用户帐户拨入属性**" 复选框，然后单击 **"确定"**。

### <a name="to-configure-nps-to-ignore-user-account-dial-in-properties"></a>将 NPS 配置为忽略用户帐户的拨入属性



## <a name="configure-nps-for-vlans"></a>为 Vlan 配置 NPS

通过在 Windows Server 2016 中使用支持 VLAN 的网络访问服务器和 NPS，你可以为用户组提供仅访问适用于其安全权限的网络资源的访问权限。 例如，你可以向访问者提供 Internet 无线访问权限，而无需允许他们访问你的组织网络。

此外，Vlan 允许以逻辑方式对位于不同物理位置或不同物理子网上的网络资源进行分组。 例如，销售部门及其网络资源（如客户端计算机、服务器和打印机）的成员可能位于你的组织中的几个不同办公楼上，但你可以将所有这些资源置于使用同一 IP 地址范围的一个 VLAN 上。 然后，VLAN 从最终用户的角度来看，作为一个子网。

如果要在不同的用户组之间隔离网络，也可以使用 Vlan。 确定要如何定义组后，可以在 "Active Directory 用户和计算机" 管理单元中创建安全组，然后将成员添加到组中。

### <a name="configure-a-network-policy-for-vlans"></a>配置 Vlan 的网络策略

你可以使用此过程来配置将用户分配到 VLAN 的网络策略。 使用可通过 VLAN 识别的网络硬件（如路由器、交换机和访问控制器）时，可以配置网络策略，以指示访问服务器将特定 Active Directory 组的成员放置在特定 Vlan 上。 此功能能够以逻辑方式将网络资源分组到 Vlan 中，在设计和实现网络解决方案时提供灵活性。

在配置用于 Vlan 的 NPS 网络策略的设置时，必须配置属性 "**隧道-类型**"、" **Pvt**"、"**隧道类型**" 和 "**隧道标记**"。

此过程作为指导原则提供;你的网络配置可能需要不同于下面所述的设置。

**Administrators**中的成员身份或同等身份是完成此过程所需的最低要求。

### <a name="to-configure-a-network-policy-for-vlans"></a>配置 Vlan 的网络策略

1. 在 NPS 上服务器管理器中，单击 "**工具**"，然后单击 "**网络策略服务器**"。 此时将打开 NPS 控制台。

2. 双击 "**策略**"，单击 "**网络策略**"，然后在详细信息窗格中，双击要配置的策略。

3. 在 "策略**属性**" 对话框中，单击 "**设置**" 选项卡。

4. 在 "策略**属性**" 的 "**设置**" 中的 " **RADIUS 属性**" 中，确保选择 "**标准**"。

5. 在详细信息窗格的 "**属性**" 中，将 "**服务类型**" 属性配置为默认值 "**分帧**"。 默认情况下，对于具有 VPN 和拨号访问方法的策略，将使用 " **PPP**" 值配置 "**分帧协议**" 属性。 若要指定 Vlan 所需的其他连接属性，请单击 "**添加**"。 此时将打开 "**添加标准 RADIUS 特性**" 对话框。

6. 在 "**添加标准 RADIUS 属性**" 的 "属性" 中，向下滚动到并添加以下属性：

    - **隧道-中等类型**。 选择适合你为策略所做的以前选择的值。 例如，如果你正在配置的网络策略是无线策略，请选择 "**值： 802 (包括所有802媒体以及以太网规范格式) **。

    - **Pvt-ID**。 输入表示将向其分配组成员的 VLAN 号码的整数。

    - **隧道类型**。 选择 "**虚拟 lan (VLAN) **。


7. 在 "**添加标准 RADIUS" 属性**中，单击 "**关闭**"。

8. 如果网络访问服务器 (NAS) 需要使用**隧道标记**属性，请使用以下步骤将**隧道标记**属性添加到网络策略。 如果你的 NAS 文档未提到此属性，请不要将其添加到策略中。 如果需要，请按如下所示添加属性：

    - 在策略**属性**中，在 "**设置**" 中的 " **RADIUS 属性**" 中单击 "**供应商特定**"。

    - 在详细信息窗格中，单击 "**添加**"。 "**添加供应商特定属性**" 对话框将打开。

    - 在 "**属性**" 中，向下滚动并选择 "**隧道标记**"，然后单击 "**添加**"。 此时将打开 "**属性信息**" 对话框。

    - 在 "**属性值**" 中，键入从硬件文档获得的值。

## <a name="configure-the-eap-payload-size"></a>配置 EAP 负载大小

在某些情况下，路由器或防火墙会丢弃数据包，因为它们被配置为丢弃需要碎片的数据包。

使用可扩展身份验证协议 \( EAP \) 和传输层安全 TLS 的网络策略以及 \( \) eap-tls 作为身份验证方法部署 nps 时，nps 用于 EAP 有效负载的默认最大传输单位 \( MTU \) 为1500字节。

EAP 有效负载的这一最大大小可以创建需要在 NPS 和 RADIUS 客户端之间通过路由器或防火墙进行分段的 RADIUS 消息。 如果出现这种情况，则在 RADIUS 客户端与 NPS 之间定位的路由器或防火墙可能会悄悄地丢弃某些片段，导致身份验证失败和访问客户端无法连接到网络。

使用以下过程，通过将网络策略中的 "帧 MTU" 属性调整为不大于1344的值，来降低 NPS 用于 EAP 有效负载的最大大小。

**Administrators**中的成员身份或同等身份是完成此过程所需的最低要求。

### <a name="to-configure-the-framed-mtu-attribute"></a>配置分帧 MTU 属性

1. 在 NPS 上服务器管理器中，单击 "**工具**"，然后单击 "**网络策略服务器**"。 此时将打开 NPS 控制台。

2. 双击 "**策略**"，单击 "**网络策略**"，然后在详细信息窗格中，双击要配置的策略。

3. 在 "策略**属性**" 对话框中，单击 "**设置**" 选项卡。

4. 在 "**设置**" 中，单击 "**标准** **"。** 在详细信息窗格中，单击 "**添加**"。 此时将打开 "**添加标准 RADIUS 特性**" 对话框。

5. 在 "**属性**" 中，向下滚动到并单击 "**分帧-MTU**"，然后单击 "**添加**"。 此时将打开 "**属性信息**" 对话框。

6. 在 "**属性值**" 中，键入等于或小于**1344**的值。 单击 **"确定**"，再单击 "**关闭**"，然后单击 **"确定"**。



有关网络策略的详细信息，请参阅[网络策略](nps-np-overview.md)。

有关模式匹配语法指定网络策略属性的示例，请参阅[在 NPS 中使用正则表达式](nps-crp-reg-expressions.md)。

有关 NPS 的详细信息，请参阅[网络策略服务器 (nps) ](nps-top.md)。
