---
title: 配置用于 PEAP 和 EAP 要求的证书模板
description: 本主题提供有关在 Windows Server 2016 中的网络策略服务器和远程访问中使用证书的信息。
manager: brianlic
ms.topic: article
ms.assetid: 2af0a1df-5c44-496b-ab11-5bc340dc96f0
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 114b64b7bdcaae0643ee03ecc2ee0a67c3e24fba
ms.sourcegitcommit: 68444968565667f86ee0586ed4c43da4ab24aaed
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/07/2020
ms.locfileid: "87992686"
---
# <a name="configure-certificate-templates-for-peap-and-eap-requirements"></a>配置用于 PEAP 和 EAP 要求的证书模板

>适用于：Windows Server（半年频道）、Windows Server 2016

使用可扩展身份验证协议 \- 传输层安全 \( EAP \- tls \) 、受保护的可扩展身份验证协议 \- 传输层安全 \( PEAP \- Tls \) 和 PEAP \- Microsoft 质询握手身份验证协议版本 2 MS CHAP v2 的网络访问身份验证所使用的所有证书 \( \- \) 必须满足对 X.509 证书的要求，以及使用安全套接字层/传输层安全性 (SSL/TLS) 的连接。 客户端和服务器证书均有额外要求。

>[!IMPORTANT]
>本主题提供有关配置证书模板的说明。 若要使用这些说明，需要使用 \( \) Active Directory 证书服务 \( AD CS 部署自己的公钥基础结构 PKI \) 。

## <a name="minimum-server-certificate-requirements"></a>最小服务器证书要求

使用 PEAP \- MS \- CHAP V2、peap \- tls 或 EAP \- tls 作为身份验证方法，NPS 必须使用满足最低服务器证书要求的服务器证书。

通过在客户端计算机上或组策略中使用 "**验证服务器证书**" 选项，可以将客户端计算机配置为验证服务器证书。

当服务器证书满足以下要求时，客户端计算机接受服务器的身份验证尝试：

- 使用者名称包含一个值。 如果将证书颁发给运行网络策略服务器的服务器 (NPS) 具有空白的使用者名称，则不能使用该证书对 NPS 进行身份验证。 通过使用者名称配置证书模板的步骤：

    1. 打开证书模板。
    2. 在详细信息窗格中，右键单击要更改的证书模板，然后单击 "**属性**"。
    3. 单击 "**使用者名称**" 选项卡，然后单击 "从此**Active Directory 信息生成**"。
    4. 在 "**使用者名称格式**" 中，选择 "**无**" 以外的值。

- 服务器上的计算机证书链接到受信任的根证书颁发机构 (CA) ，不会失败由 CryptoAPI 执行并在远程访问策略或网络策略中指定的所有检查。

- NPS 或 VPN 服务器的计算机证书配置了扩展密钥用法中的服务器身份验证目的 (EKU) 扩展。  (服务器身份验证的对象标识符为1.3.6.1.5.5.7.3.1。 ) 

- 用所需的加密设置配置服务器证书：

    1. 打开证书模板。
    2. 在详细信息窗格中，右键单击要更改的证书模板，然后单击 "**属性**"。
    3. 单击 "**加密**" 选项卡，并确保配置以下各项：
       - **提供程序类别：** 密钥存储提供程序
       - **算法名称：** RSA
       - **提供程序：** Microsoft 平台加密提供程序
       - **最小密钥大小：** 2048
       - **哈希算法：** SHA2
    4. 单击“下一步”。

- 使用者备用名称 (SubjectAltName) 扩展（如果使用）必须包含服务器的 DNS 名称。 若要将证书模板配置为域名系统 (DNS) 注册服务器的名称：

    1. 打开证书模板。
    2. 在详细信息窗格中，右键单击要更改的证书模板，然后单击 "**属性**"。
    3. 单击 "**使用者名称**" 选项卡，然后单击 "从此**Active Directory 信息生成**"。
    4. 在 "将**此信息包含在备用使用者名称**" 中，选择 " **DNS 名称**"。

使用 PEAP 和 EAP-TLS 时，NPSs 将在计算机证书存储中显示所有已安装证书的列表，但以下情况例外：

- 不显示不包含 EKU 扩展中的服务器身份验证用途的证书。

- 不显示不包含使用者名称的证书。

- 不显示基于注册表的登录证书和智能卡登录证书。

有关详细信息，请参阅为[802.1 x 有线和无线部署部署服务器证书](../../core-network-guide/cncg/server-certs/deploy-server-certificates-for-802.1x-wired-and-wireless-deployments.md)。

## <a name="minimum-client-certificate-requirements"></a>最低客户端证书要求

使用 EAP-TLS 或者 PEAP-TLS，当证书符合以下要求时，服务器将接受客户端身份验证尝试：

- 客户端证书由企业 CA 颁发，或者映射到 Active Directory 域服务 AD DS 中的用户或计算机帐户 \( \) 。

- 客户端上的用户或计算机证书会链接到受信任的根 CA，其中包括 EKU 扩展中的客户端身份验证用途 \( 。客户端身份验证的对象标识符为 1.3.6.1.5.5.7.3.2 \) ，而不是由 CryptoAPI 执行并在远程访问策略或网络策略中指定的检查以及在 NPS 网络策略中指定的证书对象标识符检查。

- 802.1X 客户端不使用智能卡登录或密码保护证书的基于注册表的证书。

- 对于用户证书，证书中的使用者可选名称 \( SubjectAltName \) 扩展包含用户主体名称 \( UPN \) 。 配置证书模板中的 UPN 的步骤：

    1. 打开证书模板。
    2. 在详细信息窗格中，右键单击要更改的证书模板，然后单击 "**属性**"。
    3. 单击 "**使用者名称**" 选项卡，然后单击 "从此**Active Directory 信息生成**"。
    4. 在 "将**此信息包含在备用使用者名称**" 中，选择 "**用户主体名称 \( UPN \) **"。

- 对于计算机证书，证书中的使用者备用名称 \( SubjectAltName \) 扩展必须包含客户端的完全限定 \( 的域名 FQDN，此 FQDN \) 也称为*DNS 名称*。 配置证书模板中此名称的步骤：

    1. 打开证书模板。
    2. 在详细信息窗格中，右键单击要更改的证书模板，然后单击 "**属性**"。
    3. 单击 "**使用者名称**" 选项卡，然后单击 "从此**Active Directory 信息生成**"。
    4. 在 "将**此信息包含在备用使用者名称**" 中，选择 " **DNS 名称**"。

使用 PEAP \- tls 和 EAP \- tls，客户端会在 "证书" 管理单元中显示所有已安装证书的列表，但以下情况例外：

- 无线客户端不显示基于注册表的登录证书和智能卡登录证书。

- 无线客户端和 VPN 客户端不显示密码保护证书。

- 不显示不包括 EKU 扩展中客户端身份验证用途的证书。


有关 NPS 的详细信息，请参阅[网络策略服务器 (nps) ](nps-top.md)。