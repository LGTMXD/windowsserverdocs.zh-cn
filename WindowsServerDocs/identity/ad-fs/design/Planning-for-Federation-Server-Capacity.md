---
ms.assetid: 7013fc21-9ced-4f9d-9588-cb04d6d60924
title: 联合服务器容量规划
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: 63bc6291ea837e96660d6aba8f37374ef4e06b8a
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/07/2020
ms.locfileid: "87947498"
---
# <a name="planning-for-federation-server-capacity"></a>联合服务器容量规划

联合服务器的容量规划有助于您估算：

-   哪些因素会增加 AD FS 配置数据库的大小。

-   每个联合服务器的相应硬件要求。

-   要放在每个组织中的联合服务器的数目。

联合服务器向用户颁发安全令牌。 将这些令牌提供给信赖方以供使用。 联合服务器在对用户进行身份验证之后或收到先前由伙伴联合身份验证服务颁发的安全令牌后颁发安全令牌。 当用户首次登录到联合应用程序时，或者当用户访问联合应用程序的安全令牌过期时，将从联合身份验证服务请求安全令牌。

联合服务器旨在容纳 \- 使用 Microsoft 网络负载平衡 NLB 技术的高可用性服务器场配置 \( \) 。 场配置中的联合服务器可以独立处理请求，而无需访问每个请求的任何公用场组件。 因此，横向扩展联合服务器部署不会产生很大的开销。

**针对**

-   对于关键任务 \- 或高 \- 可用性部署，我们建议你在每个伙伴组织中创建一个小型联合服务器场，每个场至少有两个联合服务器，以提供容错能力。

-   由于需要高可用性和轻松扩展联合服务器，因此建议使用外扩方法来处理特定联合身份验证服务每秒处理的大量请求。 在本指南中，超过基础配置的扩展不太可能产生大量的容量处理收益。

## <a name="ad-fs-configuration-database-size-and-growth"></a>AD FS 配置数据库大小和增长
AD FS 配置数据库的大小通常被视为较小，数据库大小往往不是 AD FS 部署中的主要考虑因素。  AD FS 配置数据库的准确大小在很大程度上取决于信任关系的数量，以及关联的信任 \- 相关元数据，例如声明、声明规则和为每个信任配置的监视设置。 随着配置数据库中的信任项数增加，需要更多的磁盘空间。

有关 AD FS 配置数据库的其他部署信息，请参阅[AD FS 部署拓扑注意事项](AD-FS-Deployment-Topology-Considerations.md)。

## <a name="memory-cpu-and-disk-space-requirements"></a>内存、CPU 和磁盘空间要求
幸运的是，联合服务器的内存、CPU 和磁盘空间需求适中，它们不太可能是硬件决策的驱动因素。 有关硬件要求的详细信息，请参阅[附录 A：查看 AD FS 要求](Appendix-A--Reviewing-AD-FS-Requirements.md)。

> [!NOTE]
> 在由 AD FS 产品团队执行的测试中，使用配置有专用 SQL Server 的联合服务器场来存储 AD FS 配置数据库，SQL Server 倾向上的总体负载为 low。 在使用 \- \- 配置为使用单个 SQL Server 的四个联合服务器场的一项测试中，尽管将联合服务器置于目标利用率之外，但 CPU 使用率不会超过10%。

## <a name="estimate-the-number-of-federation-servers-for-your-organization"></a><a name="bk_estimatefs"></a>估算你的组织的联合服务器的数目
为简化联合服务器的硬件规划过程，AD FS 产品团队开发了 AD FS 容量规划大小调整电子表格。 此 Excel 电子表格包括计算器 \- 等功能，这些功能将采用你为组织中的用户提供的预期使用情况数据，并为你的 AD FS 生产环境返回推荐的最佳数量的联合服务器。

> [!NOTE]
> 此电子表格将推荐的联合服务器数基于 AD FS 产品团队在测试期间使用的硬件和网络规格。 因此，必须在此上下文中理解电子表格将推荐的联合服务器的数目。  有关测试过程中使用的规范的详细信息，请参阅主题：[规划 AD FS 服务器容量](Planning-for-AD-FS-Server-Capacity.md)。

### <a name="using-the-ad-fs-capacity-planning-sizing-spreadsheet"></a>使用 AD FS 容量规划大小调整电子表格
使用此电子表格时，需要选择一个值，该值为 \( **40%**、 **60%** 或**80%** ， \) 它最能表示预期在高峰使用期间将身份验证请求发送到联合服务器的总用户数的百分比。

然后，需要选择一个值，该值为 \( **1 分钟**、 **15 分钟**或**1 小时**，以 \) 最大程度地表示高峰使用周期的持续时间。例如，你可以将40% 作为将在15分钟内登录的用户总数的值来估计，或者60% 的用户将在1小时内登录。这些值共同定义了用于计算调整大小建议的峰值负载配置文件。

接下来，你将需要根据用户是否为，指定将需要对 \- 目标声明感知应用程序进行单一登录访问的用户总数 \- ：

-   \(通过 Windows 集成身份验证从物理上连接到公司网络的本地计算机登录 Active Directory\)

-   \(通过 Windows 集成身份验证或用户名和密码从物理上未连接到公司网络的计算机上远程登录 Active Directory\)

-   来自其他组织，尝试 \- 从受信任的合作伙伴访问目标声明感知应用程序

-   从 SAML 2.0 标识提供程序尝试访问目标声明 \- 感知应用程序

#### <a name="how-to-use-this-spreadsheet"></a>如何使用此电子表格
对于你计划部署的每个联合服务器场实例，你可以使用以下步骤来确定建议的联合服务器数。

1.  下载并打开适用于[Windows server 2012 R2 的 AD FS 容量规划大小调整电子表格](https://adfsdocs.blob.core.windows.net/adfs/ADFSCapacityPlanning.xlsx)或[适用于 windows server 2016 的 AD FS 容量规划大小调整电子表格](https://adfsdocs.blob.core.windows.net/adfs/ADFSCapacity2016.xlsx)。

2.  在**高峰系统使用期内的单元中，我希望此部分用户对单元格进行身份验证**，单击该单元，然后使用下拉 \- 箭头选择估计的系统利用率级别，为**40%**、 **60%** 或**80%** （对于部署）。

3.  在位于**以下时间段**内的单元中，单击该单元，然后使用下拉 \- 箭头选择**1 分钟**、 **15 分钟**或**1 小时**，以选择高峰负载的持续时间。

4.  在 "**输入估计数量的内部应用程序 \( （如 SharePoint \( 2007 或 2010 \) 或声明感知 web 应用程序 \) ** ）" 右侧的单元格中，键入将在组织中使用的内部应用程序的数目。

5.  在 "**输入估计的联机应用程序 \( （如 Office 365 Exchange Online、SharePoint Online 或 Lync online \) ** ）的数目" 中，键入你将在你的组织中使用的联机应用程序或服务的数量。

6.  在标题为 "**用户数**" 的单元格下，在每一行上键入一个数字，该数字适用于你的用户将需要对其进行单一登录访问的示例应用场景 \- 。 此列应包含定义的用户数，而不是每秒的峰值用户数。 如果对应用程序进行的访问尝试必须首先通过 "主领域发现" 页，请键入 " **Y**"。如果不确定此选择，请键入**Y**。

7.  查看以下建议的值：

    1.  对于建议的联合服务器总数，请参阅灰色突出显示的右下角单元。

    2.  对于每个示例应用场景建议的服务器数，请参阅灰色突出显示的行中的单元格。

> [!NOTE]
> 将在标题为 "**建议的联合服务器总数**" 的单元格右侧的单元格中自动计算的值包含一个公式，该公式会将额外的20% 缓冲区添加到其前面各个行中的所有值的总和。 添加到**联合服务器总数**的公式建议将此缓冲区中的单元格构建到总的建议部署的联合服务器数，以使场中的总体负载几乎都无法达到其饱和点。

## <a name="see-also"></a>另请参阅
[Windows Server 2012 中的 AD FS 设计指南](AD-FS-Design-Guide-in-Windows-Server-2012.md)
